---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroSection from '../components/astro/sections/HeroSection.astro';
import TextSection from '../components/astro/sections/TextSection.astro';
import CardGridSection from '../components/astro/sections/CardGridSection.astro';
import CtaSection from '../components/astro/sections/CtaSection.astro';

// Get all pages and find the one marked as landing page
const allPages = await getCollection('pages');
const landingPage = allPages.find(page => page.data.isLandingPage === true);

// Fallback to 'home' page if no landing page is set
const page = landingPage || allPages.find(page => page.id === 'home');

if (!page) {
  return Astro.redirect('/404');
}

const { title, metaDescription, sections } = page.data;

// Sort sections by order
const sortedSections = [...sections].sort((a, b) => a.order - b.order);
---

<BaseLayout title={title} description={metaDescription}>
  {sortedSections.map((section) => {
    switch (section.type) {
      case 'hero':
        return <HeroSection section={section} />;
      case 'text':
        return <TextSection section={section} />;
      case 'cardGrid':
        return <CardGridSection section={section} />;
      case 'cta':
        return <CtaSection section={section} />;
      default:
        return null;
    }
  })}
</BaseLayout>
